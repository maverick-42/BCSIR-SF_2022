
#include <ETH.h>
#include <WiFi.h>
#include <WiFiAP.h>
#include <WiFiSTA.h>
#include <WiFiUdp.h>
#include <WiFiScan.h>
#include <WiFiType.h>
#include <WiFiMulti.h>
#include <WiFiClient.h>
#include <WiFiServer.h>
#include <HTTPClient.h>
#include <WiFiGeneric.h>
#include <BluetoothSerial.h>

#include <SPI.h>
#include <MFRC522.h>
#include <AsyncTCP.h>
#include <Adafruit_MQTT.h>
#include <AsyncElegantOTA.h>
#include <ESPAsyncWebServer.h>
#include <Adafruit_MQTT_Client.h> 


/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/


String User_A = "00 0S 00 0S";
String User_B = "01 0S 01 0S";
String User_C = "E7 72 8A 7B";

#define BDT                 " BDT."
#define Message_I           "QR code invalid."
#define Message_G           "Welcome to Bangladesh Road Transportation AFC System."
#define Message_B           "Please place your user card in front of the scanner..."
#define Message_U           "User card tapped at bus : "
#define Message_A           "Available balance : "
#define Message_C           "Your current balance : "
#define Message_Y           "Please recharge your card!"
#define Message_T           "You do not have the required amount to travel with us."
#define Message_F           "Thank you for choosing us!"
#define Safety_Measurement  "Stay Safe.Stay Healthy."

String Uttara        = "10 1S 00 1S";
String Mirpur_10     = "20 2S 10 2S";
String Agargaon      = "30 2S 20 2S";
String Shahbag       = "40 2S 30 2S";
String Motijheel     = "50 2S 40 2S";

int Available_Balance_A = random(100,250);
int Available_Balance_B = random(175,415);
int Available_Balance_C = random(0,8);

int Bus = random(1,10);

int rstPIN = 22;
int ssPIN  =  5;
MFRC522 mfrc522(ssPIN, rstPIN);


/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/


//Adafruit.io Setup

#define AIO_SERVER      "io.adafruit.com"
#define AIO_SERVERPORT  1883                   
#define AIO_USERNAME   "_Maverick_"
#define AIO_KEY        "aio_xmvu79ZHm4zVbpwbPuqCBrKOaHZr"

  
// BLUETOOTH CLIENT

#if !defined(CONFIG_BT_ENABLED) || !defined(CONFIG_BLUEDROID_ENABLED)
#error Bluetooth is not enabled! Please run
`make menuconfig` to and enable it
#endif
BluetoothSerial SerialBT;

// WIFI CLIENT

#define WLAN_SSID       "TP-LINK_D8B6"
#define WLAN_PASS       "farhan2758"
WiFiClient client;

// MQTT CLIENT

Adafruit_MQTT_Client mqtt(&client, AIO_SERVER, AIO_SERVERPORT, AIO_USERNAME, AIO_KEY);
Adafruit_MQTT_Publish TTPAFC = Adafruit_MQTT_Publish(&mqtt, AIO_USERNAME"/feeds/TTPAFC"); 

AsyncWebServer server(80);
void MQTT_connect();
int bluedata;
int variable = 0;


/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/


void setup() 
{
  Serial.begin(115200);

  // Connection to WiFi access point. 
  {
  Serial.println();Serial.println();
  Serial.print("Connecting to ");
  Serial.println(WLAN_SSID);
 
  WiFi.mode(WIFI_STA);
  WiFi.begin(WLAN_SSID, WLAN_PASS);
  while (WiFi.status() != WL_CONNECTED) 
  {
    delay(500);
    Serial.print(".");
  }
  Serial.println();
  Serial.println("WiFi connected!");
  Serial.println("IP address: "); 
  Serial.println(WiFi.localIP());
  Serial.println();
  }
  
  // Connection to BLE access point.
  { 
  btStart();  
  Serial.println("Bluetooth On!");
  SerialBT.begin("ESP32_Bluetooth");
  Serial.println("The device started, now you can pair it with bluetooth!");
  Serial.println();
  }

  // Connection to ASYNC access point.
  { 
  AsyncElegantOTA.begin(&server);
  server.begin();
  Serial.println("ASYNC server started!");
  Serial.println();
  }
  
  SPI.begin();
  mfrc522.PCD_Init();
  
  Serial.println(Message_G);
  Serial.println(Message_B);
  
  TTPAFC.publish(Message_G);
  TTPAFC.publish(Message_B);
}


/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/


void loop() 
{

      while(SerialBT.available())
    {
      bluedata = SerialBT.parseInt();
      Serial.println();
      delay(20);
      if (bluedata == 1) {
        Serial.println("Passenger boarded at 'Shahbag' station.");
        Serial.println("Passenger Name : A ");              
        Serial.println(Message_F);
        Serial.println(Safety_Measurement);
        
        TTPAFC.publish("Passenger boarded at 'Shahbag' station.");
        TTPAFC.publish("Passenger Name : A ");
        TTPAFC.publish(Message_F);
        TTPAFC.publish(Safety_Measurement);   
        }
      else if (bluedata == 2) {
        Serial.println("Passenger boarded at 'Mirpur-10' station.");
        Serial.println("Passenger Name : B ");              
        Serial.println(Message_F);
        Serial.println(Safety_Measurement);
        
        TTPAFC.publish("Passenger boarded at 'Mirpur-10' station.");
        TTPAFC.publish("Passenger Name : B "); 
        TTPAFC.publish(Message_F);
        TTPAFC.publish(Safety_Measurement);      
        }
      else if (bluedata == 3) {
        Serial.println("Passenger boarded at 'Uttara' station.");
        Serial.println("Passenger Name : A ");              
        Serial.println(Message_F);
        Serial.println(Safety_Measurement);
        
        TTPAFC.publish("Passenger boarded at 'Uttara' station.");
        TTPAFC.publish("Passenger Name : A "); 
        TTPAFC.publish(Message_F);
        TTPAFC.publish(Safety_Measurement);          
        }
      else if (bluedata == 4) {
        Serial.println("Passenger boarded at 'Cantonment' station.");
        Serial.println("Passenger Name : B ");              
        Serial.println(Message_F);
        Serial.println(Safety_Measurement);
        
        TTPAFC.publish("Passenger boarded at 'Cantonment' station.");
        TTPAFC.publish("Passenger Name : B ");
        TTPAFC.publish(Message_F);
        TTPAFC.publish(Safety_Measurement);        
        }
       else if (bluedata == 5) {
        Serial.println(Message_I);
        TTPAFC.publish(Message_I);                    
        }
    }
    
  if ( ! mfrc522.PICC_IsNewCardPresent()) 
  {
    return;
  }
  if ( ! mfrc522.PICC_ReadCardSerial()) 
  {
    return;
  }
  
  String content= "";
  byte letter;
  
  for (byte i = 0; i < mfrc522.uid.size; i++) 
  {
     Serial.print(mfrc522.uid.uidByte[i] < 0x10 ? " 0" : " ");
     Serial.print(mfrc522.uid.uidByte[i], HEX);
     content.concat(String(mfrc522.uid.uidByte[i] < 0x10 ? " 0" : " "));
     content.concat(String(mfrc522.uid.uidByte[i], HEX));
  }
  
  
  Serial.println();
  content.toUpperCase();

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/

 if (Bus == 1 || Bus == 3 || Bus == 5 || Bus == 7 || Bus == 9)
 { 
  if (content.substring(1) == Uttara)
  {
    Serial.println("Bus currently at 'Uttara' station.");
    TTPAFC.publish("Bus currently at 'Uttara' station.");
    
        if (content.substring(1) == User_A)
          {
            String Balance_A = String(Available_Balance_A);
            
            Serial.println("Passenger boarded at 'Uttara' station.");
            Serial.println("Passenger Name : A ");
            Serial.println(Message_U + Bus);
            Serial.println(Message_A + Balance_A + BDT);
            
            TTPAFC.publish("Passenger boarded at 'Uttara' station.");
            TTPAFC.publish("Passenger Name : A ");
            TTPAFC.publish(Message_U + Bus);
            TTPAFC.publish(Message_A + Balance_A + BDT);            
            Serial.println();
                
                if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");   
                      
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 30 from your account.");
                    
                        int    Current_Balance_A = Available_Balance_A - 30;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);                        
                      }                      
                      else{}        
                  }
                 if (content.substring(1) == Agargaon)
                  {
                    Serial.println("Bus reached 'Agargaon' station.");
                    TTPAFC.publish("Bus reached 'Agargaon' station."); 
                      
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 40 from your account.");
                    
                        int    Current_Balance_A = Available_Balance_A - 40;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{}  
                  }
                 if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 60 from your account.");
                    
                        int    Current_Balance_A = Available_Balance_A - 60;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{} 
                  }
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");
                      
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 70 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 70;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{}  
                  }                                        
            }

 /****************************************************************************************************************************************************************************************************************************************************************************/

        if (content.substring(1) == User_B)
          {
            Serial.println("Passenger boarded at 'Uttara' station.");
            Serial.println("Passenger Name : B ");
            Serial.println(Message_U + Bus);
            String Balance_B = String(Available_Balance_B);
            Serial.println(Message_A + Balance_B + BDT);
            Serial.println();
                
                if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");  
                      
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 30 from your account.");
                    
                        int    Current_Balance_B = Available_Balance_B - 30;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{}        
                  }
                 if (content.substring(1) == Agargaon)
                  {
                    Serial.println("Bus reached 'Agargaon' station.");
                    TTPAFC.publish("Bus reached 'Agargaon' station.");
                      
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 40 from your account.");
                    
                        int    Current_Balance_B = Available_Balance_B - 40;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{}  
                  }
                 if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 60 from your account.");
                    
                        int    Current_Balance_B = Available_Balance_B - 60;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{} 
                  }
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");
                      
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 70 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 70;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }                      
                      else{}  
                  }                                        
            }

/****************************************************************************************************************************************************************************************************************************************************************************/    
           
            if (content.substring(1) == User_C)
            {
              String Balance_C = String(Available_Balance_C);
              Serial.println(Message_U + Bus);
              Serial.println("User Name : C ");
              Serial.println(Message_A + Balance_C + BDT); 
              Serial.println(Message_T);
              Serial.println(Message_P);

              TTPAFC.publish(Message_U + Bus);
              TTPAFC.publish("User Name : C ");
              TTPAFC.publish(Message_A + Balance_C + BDT);
              TTPAFC.publish(Message_T);
              TTPAFC.publish(Message_Y);    
            }
          }   

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/                              
    
     else if (content.substring(1) == Mirpur_10)
     {
       Serial.println("Bus currently at 'Mirpur-10' station.");
       TTPAFC.publish("Bus currently at 'Mirpur-10' station.");
     
                if (content.substring(1) == User_A)
                 {
                   Serial.println("Passenger boarded at 'Mirpur-10' station.");
                   Serial.println("Passenger Name : A ");
                   Serial.println(Message_U + Bus);
                   String Balance_A = String(Available_Balance_A);
                   Serial.println(Message_A + Balance_A + BDT);
                   Serial.println();
                  
                    if (content.substring(1) == Agargaon)
                     { 
                      Serial.println("Bus reached 'Agargaon' station.");
                      TTPAFC.publish("Bus reached 'Agargaon' station.");
                     
                        if (content.substring(1) == User_A)
                        {
                          Serial.println("Deducted BDT 10 from your account.");
                          
                          int    Current_Balance_A = Available_Balance_A - 10;
                          String Message_S         = String(Current_Balance_A);  
                          String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement); 
                        }
                        else{} 
                     }
                 if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 30;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");
                    
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 40 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 40;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                }
                  
/****************************************************************************************************************************************************************************************************************************************************************************/          

     
                if (content.substring(1) == User_B)
                 {
                   Serial.println("Passenger boarded at 'Mirpur-10' station.");
                   Serial.println("Passenger Name : B ");
                   Serial.println(Message_U + Bus);
                   String Balance_B = String(Available_Balance_B);
                   Serial.println(Message_A + Balance_B + BDT);
                   Serial.println();
                  
                    if (content.substring(1) == Agargaon)
                     { 
                        Serial.println("Bus reached 'Agargaon' station.");
                        TTPAFC.publish("Bus reached 'Agargaon' station.");
                     
                        if (content.substring(1) == User_B)
                        {
                          Serial.println("Deducted BDT 10 from your account.");
                          
                          int    Current_Balance_B = Available_Balance_B - 10;
                          String Message_S         = String(Current_Balance_B);  
                          String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                        }
                        else{} 
                     }
                 if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 30;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}
                  }
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");
                    
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 40 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 40;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 }

/****************************************************************************************************************************************************************************************************************************************************************************/    
           
            if (content.substring(1) == User_C)
            {
              String Balance_C = String(Available_Balance_C);
              Serial.println(Message_U + Bus);
              Serial.println("User Name : C ");
              Serial.println(Message_A + Balance_C + BDT); 
              Serial.println(Message_T);
              Serial.println(Message_P);

              TTPAFC.publish(Message_U + Bus);
              TTPAFC.publish("User Name : C ");
              TTPAFC.publish(Message_A + Balance_C + BDT);
              TTPAFC.publish(Message_T);
              TTPAFC.publish(Message_Y);    
            }
          }

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/
                  
    
    else if (content.substring(1) == Agargaon)
          {
            Serial.println("Bus currently at 'Agargaon' station.");
            TTPAFC.publish("Bus currently at 'Agargaon' station.");

              if (content.substring(1) == User_A)
              {
                   Serial.println("Passenger boarded at 'Agargaon' station.");
                   Serial.println("Passenger Name : A ");
                   Serial.println(Message_U + Bus);
                   String Balance_A = String(Available_Balance_A);
                   Serial.println(Message_A + Balance_A + BDT);
                   Serial.println();

                 if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 20 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 20;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);    
                      }
                      else{}
                  } 
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");

                      if (content.substring(1) == User_A)
                      {                    
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 30;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}
                  }               
          }

/****************************************************************************************************************************************************************************************************************************************************************************/

              if (content.substring(1) == User_B)
              {
                   Serial.println("Passenger boarded at 'Agargaon' station.");
                   Serial.println("Passenger Name : B ");
                   Serial.println(Message_U + Bus);
                   String Balance_B = String(Available_Balance_B);
                   Serial.println(Message_A + Balance_B + BDT);
                   Serial.println();

                 if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 20 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 20;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);     
                      }
                      else{}
                  } 
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");

                      if (content.substring(1) == User_B)
                      {                    
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 30;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }               
           }

/****************************************************************************************************************************************************************************************************************************************************************************/    
           
            if (content.substring(1) == User_C)
            {
              String Balance_C = String(Available_Balance_C);
              Serial.println(Message_U + Bus);
              Serial.println("User Name : C ");
              Serial.println(Message_A + Balance_C + BDT); 
              Serial.println(Message_T);
              Serial.println(Message_P);

              TTPAFC.publish(Message_U + Bus);
              TTPAFC.publish("User Name : C ");
              TTPAFC.publish(Message_A + Balance_C + BDT);
              TTPAFC.publish(Message_T);
              TTPAFC.publish(Message_Y);   
            }
          }

 /****************************************************************************************************************************************************************************************************************************************************************************/
 /****************************************************************************************************************************************************************************************************************************************************************************/                  
          
    else if (content.substring(1) == Shahbag)
          {
            Serial.println("Bus currently at 'Shahbag' station.");
            TTPAFC.publish("Bus currently at 'Shahbag' station.");

              if (content.substring(1) == User_A)
              {
                   Serial.println("Passenger boarded at 'Shahbag' station.");
                   Serial.println("Passenger Name : A ");
                   Serial.println(Message_U + Bus);
                   String Balance_A = String(Available_Balance_A);
                   Serial.println(Message_A + Balance_A + BDT);
                   Serial.println();
                   
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");
                      
                      if (content.substring(1) == User_A)
                      {
                        Serial.println("Deducted BDT 10 from your account.");

                        int Current_Balance_A = Available_Balance_A - 10;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement); 
                      }
                      else{}
                  }                
             }

/****************************************************************************************************************************************************************************************************************************************************************************/
               
               if (content.substring(1) == User_B)
              {
                   Serial.println("Passenger boarded at 'Shahbag' station.");
                   Serial.println("Passenger Name : B ");
                   Serial.println(Message_U + Bus);
                   String Balance_B = String(Available_Balance_B);
                   Serial.println(Message_A + Balance_B + BDT);
                   Serial.println();
                   
                 if (content.substring(1) == Motijheel)
                  {
                    Serial.println("Bus reached 'Motijheel' station.");
                    TTPAFC.publish("Bus reached 'Motijheel' station.");
                      
                      if (content.substring(1) == User_B)
                      {
                        Serial.println("Deducted BDT 10 from your account.");

                        int Current_Balance_B = Available_Balance_B - 10;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);
                      }
                      else{}
                  }                
             }                                   

/****************************************************************************************************************************************************************************************************************************************************************************/    
           
            if (content.substring(1) == User_C)
            {
              String Balance_C = String(Available_Balance_C);
              Serial.println(Message_U + Bus);
              Serial.println("User Name : C ");
              Serial.println(Message_A + Balance_C + BDT); 
              Serial.println(Message_T);
              Serial.println(Message_P);

              TTPAFC.publish(Message_U + Bus);
              TTPAFC.publish("User Name : C ");
              TTPAFC.publish(Message_A + Balance_C + BDT);
              TTPAFC.publish(Message_T);
              TTPAFC.publish(Message_Y);    
            }
          }    
 } 

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/
 
 if (Bus == 2 || Bus == 4 || Bus == 6 || Bus == 8 || Bus == 10)
 {
  if (content.substring(1) == Motijheel)
  {
    Serial.println("Bus currently at 'Motijheel' station.");
    TTPAFC.publish("Bus currently at 'Motijheel' station.");

       if (content.substring(1) == User_A)
       {
        Serial.println("Passenger boarded at 'Motijheel' station.");
        Serial.println("Passenger Name : A ");
        Serial.println(Message_U + Bus);
        String Balance_A = String(Available_Balance_A);
        Serial.println(Message_A + Balance_A + BDT);
        Serial.println();   
    
                if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 10 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 10;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 if (content.substring(1) == Agargaon)
                  {
                    Serial.println("Bus reached 'Agargaon' station.");
                    TTPAFC.publish("Bus reached 'Agargaon' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 30;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}   
                  }
                 if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 40 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 40;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 70 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 70;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}
                  }                                        
          }  

/****************************************************************************************************************************************************************************************************************************************************************************/

       if (content.substring(1) == User_B)
       {
        Serial.println("Passenger boarded at 'Motijheel' station.");
        Serial.println("Passenger Name : B ");
        Serial.println(Message_U + Bus);
        String Balance_B = String(Available_Balance_B);
        Serial.println(Message_A + Balance_B + BDT);
        Serial.println();   
    
                if (content.substring(1) == Shahbag)
                  {
                    Serial.println("Bus reached 'Shahbag' station.");
                    TTPAFC.publish("Bus reached 'Shahbag' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 10 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 10;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}
                  }
                 if (content.substring(1) == Agargaon)
                  {
                    Serial.println("Bus reached 'Agargaon' station.");
                    TTPAFC.publish("Bus reached 'Agargaon' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 30;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}   
                  }
                 if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 40 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 40;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 70 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 70;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}
                  }                                        
          }

/****************************************************************************************************************************************************************************************************************************************************************************/
       
      if (content.substring(1) == User_C)
      {
        String Balance_C = String(Available_Balance_C);
        Serial.println(Message_U + Bus);
        Serial.println("User Name : C ");
        Serial.println(Message_A + Balance_C + BDT); 
        Serial.println(Message_T);
        Serial.println(Message_P);

        TTPAFC.publish(Message_U + Bus);
        TTPAFC.publish("User Name : C ");
        TTPAFC.publish(Message_A + Balance_C + BDT);
        TTPAFC.publish(Message_T);
        TTPAFC.publish(Message_Y);    
      }
    }

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/

  if (content.substring(1) == Shahbag)
  {
    Serial.println("Bus currently at 'Shahbag' station.");
    TTPAFC.publish("Bus currently at 'Shahbag' station.");

       if (content.substring(1) == User_A)
       {
        Serial.println("Passenger boarded at 'Shahbag' station.");
        Serial.println("Passenger Name : A ");
        Serial.println(Message_U + Bus);
        String Balance_A = String(Available_Balance_A);
        Serial.println(Message_A + Balance_A + BDT);
        Serial.println();   
    
                if (content.substring(1) == Agargaon)
                  {
                    Serial.println("Bus reached 'Agargaon' station.");
                    TTPAFC.publish("Bus reached 'Agargaon' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 20 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 20;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}
                  }
                 if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 30;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}   
                  }
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 60 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 60;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }                                        
          }  

/****************************************************************************************************************************************************************************************************************************************************************************/

       if (content.substring(1) == User_B)
       {
        Serial.println("Passenger boarded at 'Shahbag' station.");
        Serial.println("Passenger Name : B ");
        Serial.println(Message_U + Bus);
        String Balance_B = String(Available_Balance_B);
        Serial.println(Message_A + Balance_B + BDT);
        Serial.println();   
    
                 if (content.substring(1) == Agargaon)
                  {
                    Serial.println("Bus reached 'Agargaon' station.");
                    TTPAFC.publish("Bus reached 'Agargaon' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 20 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 20;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}   
                  }
                 if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 30 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 30;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 60 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 60;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }                                        
          }

/****************************************************************************************************************************************************************************************************************************************************************************/
       
      if (content.substring(1) == User_C)
      {
        String Balance_C = String(Available_Balance_C);
        Serial.println(Message_U + Bus);
        Serial.println("User Name : C ");
        Serial.println(Message_A + Balance_C + BDT); 
        Serial.println(Message_T);
        Serial.println(Message_P);

        TTPAFC.publish(Message_U + Bus);
        TTPAFC.publish("User Name : C ");
        TTPAFC.publish(Message_A + Balance_C + BDT);
        TTPAFC.publish(Message_T);
        TTPAFC.publish(Message_Y);    
      }
    }    

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/
 
  if (content.substring(1) == Agargaon)
  {
    Serial.println("Bus currently at 'Agargaon' station.");
    TTPAFC.publish("Bus currently at 'Agargaon' station.");

       if (content.substring(1) == User_A)
       {
        Serial.println("Passenger boarded at 'Agargaon' station.");
        Serial.println("Passenger Name : A ");
        Serial.println(Message_U + Bus);
        String Balance_A = String(Available_Balance_A);
        Serial.println(Message_A + Balance_A + BDT);
        Serial.println();   
    
                 if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 10 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 10;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);  
                      }
                      else{}   
                  }
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 40 from your account.");

                        int    Current_Balance_A = Available_Balance_A - 40;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }                                        
          }  

/****************************************************************************************************************************************************************************************************************************************************************************/

       if (content.substring(1) == User_B)
       {
        Serial.println("Passenger boarded at 'Agargaon' station.");
        Serial.println("Passenger Name : B ");
        Serial.println(Message_U + Bus);
        String Balance_B = String(Available_Balance_B);
        Serial.println(Message_A + Balance_B + BDT);
        Serial.println();   
    
                 if (content.substring(1) == Mirpur_10)
                  {
                    Serial.println("Bus reached 'Mirpur-10' station.");
                    TTPAFC.publish("Bus reached 'Mirpur-10' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 10 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 10;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 40 from your account.");

                        int    Current_Balance_B = Available_Balance_B - 40;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }                                        
          }

/****************************************************************************************************************************************************************************************************************************************************************************/
       
      if (content.substring(1) == User_C)
      {
        String Balance_C = String(Available_Balance_C);
        Serial.println(Message_U + Bus);
        Serial.println("User Name : C ");
        Serial.println(Message_A + Balance_C + BDT); 
        Serial.println(Message_T);
        Serial.println(Message_P);

        TTPAFC.publish(Message_U + Bus);
        TTPAFC.publish("User Name : C ");
        TTPAFC.publish(Message_A + Balance_C + BDT);
        TTPAFC.publish(Message_T);
        TTPAFC.publish(Message_Y);    
      }
    } 

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/

  if (content.substring(1) == Mirpur_10)
  {
    Serial.println("Bus currently at 'Mirpur-10' station.");
    TTPAFC.publish("Bus currently at 'Mirpur-10' station.");

       if (content.substring(1) == User_A)
       {
        Serial.println("Passenger boarded at 'Mirpur-10' station");
        Serial.println("Passenger Name : A ");
        Serial.println(Message_U + Bus);
        String Balance_A = String(Available_Balance_A);
        Serial.println(Message_A + Balance_A + BDT);
        Serial.println();   
    
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_A)
                      { 
                        Serial.println("Deducted BDT 30 from your account");

                        int    Current_Balance_A = Available_Balance_A - 30;
                        String Message_S         = String(Current_Balance_A);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);
                        
                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement);   
                      }
                      else{}
                  }                                        
       }  

/****************************************************************************************************************************************************************************************************************************************************************************/

       if (content.substring(1) == User_B)
       {
        Serial.println("Passenger boarded at 'Mirpur-10' station");
        Serial.println("Passenger Name : B ");
        Serial.println(Message_U + Bus);
        String Balance_B = String(Available_Balance_B);
        Serial.println(Message_A + Balance_B + BDT);
        Serial.println();   
    
                 if (content.substring(1) == Uttara)
                  {
                    Serial.println("Bus reached 'Uttara' station.");
                    TTPAFC.publish("Bus reached 'Uttara' station.");
                      
                      if (content.substring(1) == User_B)
                      { 
                        Serial.println("Deducted BDT 30 from your account");

                        int    Current_Balance_B = Available_Balance_B - 30;
                        String Message_S         = String(Current_Balance_B);  
                        String Message           = Message_C + Message_S + BDT;
                    
                        Serial.println(Message);
                        Serial.println(Message_F);
                        Serial.println(Safety_Measurement);

                        TTPAFC.publish(Message);
                        TTPAFC.publish(Message_F);
                        TTPAFC.publish(Safety_Measurement); 
                      }
                      else{}
                  }                                        
          }

/****************************************************************************************************************************************************************************************************************************************************************************/
       
      if (content.substring(1) == User_C)
      {
        String Balance_C = String(Available_Balance_C);
        Serial.println(Message_U + Bus);
        Serial.println("User Name : C ");
        Serial.println(Message_A + Balance_C + BDT); 
        Serial.println(Message_T);
        Serial.println(Message_P);

        TTPAFC.publish(Message_U + Bus);
        TTPAFC.publish("User Name : C ");
        TTPAFC.publish(Message_A + Balance_C + BDT);
        TTPAFC.publish(Message_T);
        TTPAFC.publish(Message_Y);   
      }
    }
  }            
}

/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/
/****************************************************************************************************************************************************************************************************************************************************************************/

void MQTT_connect() 
 
  {  
  int8_t ret;
  if (mqtt.connected()) {
    return;
  }
  
  Serial.print("Connecting to MQTT... ");

  uint8_t retries = 3;
  
  while ((ret = mqtt.connect()) != 0) {
    Serial.println(mqtt.connectErrorString(ret));
    Serial.println("Retrying MQTT connection in 5 seconds...");
    mqtt.disconnect();
    delay(5000); 
    retries--;
    if (retries == 0) {
      while (1);
    }
   }
   Serial.println("MQTT Connected!\n");
  }   
